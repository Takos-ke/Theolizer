<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Theolizer: enum型のアップデート／バージョン・アップ方法</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Theolizer
   &#160;<span id="projectnumber">Version.1.1.1</span>
   </div>
   <div id="projectbrief">serializer for C++ / Do you want to update your classes easily ?</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 構築: Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'検索');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','検索');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_changing_enum.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">enum型のアップデート／バージョン・アップ方法 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>ここでは、enum型を修正した時、古いプログラムが保存したデータを回復するための各種指定方法を説明します。<br />
</p>
<h3>デフォルト値について</h3>
<p>最初にデフォルト値について説明します。<br />
 enumのシンボルを定義している先頭のシンボルの値をTheolizerは「デフォルト値」として用います。<br />
 <a class="el" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b" title="アノテーション用マクロ ">THEOLIZER_ANNOTATE(ES)</a>による指定を間違った場合、enum値保存／回復やバージョン・アップ／ダウン時に対応するシンボルが見つからない場合があります。その時、警告を報告(例外にはなりません。)し、変換先の値を「デフォルト値」にします。</p>
<p><br />
 </p><h6></h6>
<h1><a class="anchor" id="HowToModifyEnum1"></a>
1.バージョン番号を変えないでenum型を修正</h1>
<h6></h6>
<p>バージョン番号を変えない場合に可能なenum型の修正は以下のものがあります。</p>
<ol type="1">
<li>シンボル名保存の場合<ul>
<li>シンボル値の変更<br />
 シリライズ・データ中にシンボル値は記録されないため、シリアライズ処理とは無関係な変更です。<br />
 従って、特にシリアライズ用に指定する必要はありません。<br />
</li>
<li>シンボル名の変更<br />
 変更前のシンボル名で保存されたシリアライズ・データを回復できるようにするためには、変更前のシンボル名がどのシンボルへ対応するのか、Theolizerへ教える必要があります。<br />
 そのためにTHEOLIZER_ANNOTATE(ES:)の第１パラメータを使います。<br />
 <br />
</li>
</ul>
</li>
<li>シンボル値保存の場合<ul>
<li>シンボル名の変更<br />
 シリライズ・データ中にシンボル名は記録されないため、シリアライズ処理とは無関係な変更です。<br />
 従って、特にシリアライズ用に指定する必要はありません。<br />
</li>
<li>シンボル値の変更<br />
 変更前のシンボル値で保存されたシリアライズ・データを回復できるようにするためには、変更前のシンボル値がどのシンボルへ対応するのか、Theolizerへ教える必要があります。<br />
 そのためにTHEOLIZER_ANNOTATE(ES:)の第２パラメータを使います。<br />
 <br />
</li>
</ul>
</li>
<li>共通<ul>
<li>シンボルの追加<br />
 古いシリアライズ・データに、新規追加したシンボル名／値が記録されることはありませんので、シリアライズ用の対応は何もありません。</li>
<li>シンボルの削除<br />
 削除前のシンボル名／値に対応するシンボルをTHEOLIZER_ANNOTATE(ES:)で指定していない場合、削除されたシンボル名／値を回復する時に警告が報告されます。それを避けるためには、例えば「デフォルト値」へシンボル名／値が変更されたように指定して下さい。複数の旧シンボルを１つの現シンボルへ指定可能ですので複数のシンボルを削除した場合にも対応できます。<br />
</li>
</ul>
</li>
</ol>
<p>注：シンボル値保存／シンボル名保存の指定方法については<a class="el" href="_enum_variation.html">enum型のバリエーション</a> を参照下さい。</p>
<p><a class="el" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b" title="アノテーション用マクロ ">THEOLIZER_ANNOTATE(ES:)</a>の指定方法は以下の通りです。</p>
<div class="fragment"><div class="line">enumシンボル <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:シンボル名リスト:シンボル値リスト)=値,</div><div class="line">    :</div></div><!-- fragment --><p> 「シンボル名リスト」はシンボル名保存時に指定します。<br />
 「シンボル値リスト」はシンボル値保存時に指定します。 「=値」は通常のenum型と同じく省略可能です。</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px; background-color: #d0d0d0;"> <b><a class="el" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b" title="アノテーション用マクロ ">THEOLIZER_ANNOTATE(ES:)</a>を記述する位置が直感的な位置ではないですので、ご注意下さい。</b><br />
 シンボルの<b>直後</b>です。この機能の実装にclangの属性指定(<b>attribute</b>())機能を使っていますが、enum型のシンボルの属性指定は、この位置のみ書けます。 </div><p><br />
 </p>
<h2><a class="anchor" id="HowToModifyEnum11"></a>
1-1.シンボル名保存の変更サンプル</h2>
<p>下記の修正を行うサンプルです。</p>
<ul>
<li>eesnName11をeesnName10へ変更</li>
<li>eesnName20, eesnName21, eesnName22をeesnName20へ統合<br />
 「eesnName21, eesnName22を削除して、eesnName20へ割り当てた」のと同じです。</li>
</ul>
<p><b>変更前(ver1a)のソース</b>(source/reference_and_test/ver1a/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><span class="keyword">enum</span> EnumSymName</div><div class="line">{</div><div class="line">    eesnName11,             <span class="comment">// 単にシンボル変更</span></div><div class="line">    eesnName20,             <span class="comment">// 3つのシンボルを先頭の1つへ統合する</span></div><div class="line">    eesnName21,</div><div class="line">    eesnName22,</div></div><!-- fragment --> (後略)</p>
<p><b>変更後(ver1b)のソース</b>(source/reference_and_test/ver1b/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><span class="keyword">enum</span> EnumSymName</div><div class="line">{</div><div class="line">    eesnName10  <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:eesnName11),</div><div class="line"></div><div class="line">    <span class="comment">// 3つのシンボルを先頭の1つへ統合する</span></div><div class="line">    eesnName20  <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:eesnName21,eesnName22),</div></div><!-- fragment --> (後略)</p>
<p><br />
 </p>
<h2><a class="anchor" id="HowToModifyEnum12"></a>
1-2.シンボル値保存の変更サンプル</h2>
<p>修正内容はEnumSymNameの場合と同等です。</p>
<p><b>変更前(ver1a)のソース</b>(source/reference_and_test/ver1a/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><span class="keyword">enum</span> EnumSymVal</div><div class="line">{</div><div class="line">    eesvValue11=11,         <span class="comment">// 単にシンボル変更</span></div><div class="line">    eesvValue20=20,         <span class="comment">// 3つのシンボルを先頭の1つへ統合する</span></div><div class="line">    eesvValue21=21,</div><div class="line">    eesvValue22=22,</div></div><!-- fragment --> (後略)</p>
<p><b>変更後(ver1b)のソース</b>(source/reference_and_test/ver1b/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><span class="keyword">enum</span> EnumSymVal</div><div class="line">{</div><div class="line">    eesvValue10     <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES::11)=10,</div><div class="line"></div><div class="line">    <span class="comment">// 3つのシンボルを先頭の1つへ統合する</span></div><div class="line">    eesvValue20     <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES::21,22)=20,</div></div><!-- fragment --> (後略)</p>
<p><br />
 </p><h6></h6>
<h1><a class="anchor" id="HowToMakeGlobalVersionNoTable"></a>
2.グローバル・バージョン番号テーブル生成</h1>
<h6></h6>
<p>enum型解説の途中ですが、ここでバージョン・アップ前の準備について説明します。<br />
 今までバージョン管理していなかった時にバージョン管理を始める時、<a class="el" href="_specification.html#Basic32">3-2.バージョン番号管理について</a> で説明した「グローバル・バージョン番号テーブル」の生成が必要になります。</p>
<p>そのために必要な作業は以下の通りです。</p><ul>
<li>グローバル・バージョン番号テーブルの宣言</li>
<li>グローバル・バージョン番号テーブル実体定義</li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="HowToMakeGlobalVersionNoTable21"></a>
2-1.グローバル・バージョン番号テーブルの宣言</h2>
<p>シリライズ処理するコンパイル単位全てがインクルードするヘッダファイルで宣言して下さい。<br />
 具体的には下記書式で宣言します。</p>
<div class="fragment"><div class="line"><a class="code" href="serializer_8h.html#aed67475e426a84a276f60ae416b6fea1">THEOLIZER_DEFINE_GLOBAL_VERSION_TABLE</a>(テーブル名, グローバル・バージョン番号);</div></div><!-- fragment --><p>テーブル名は任意の識別子です。これはtheolizer::internal::global_table名前空間内で必要なコードを定義する時の識別子の一部として用いられます。<br />
 グローバル・バージョン番号は最初は必ず1として下さい。その後、バージョンを上げる度に1づつインクリメントして下さい。</p>
<div style="padding: 10px; margin-bottom: 10px; border: 1px solid #333333; border-radius: 10px; background-color: #d0d0d0;"> グローバル・バージョン番号が１つ増える度にクラスやenum型のローカル・バージョン番号も最大1つ上げることができます。既に現在のグローバル・バージョン番号でクラスかenum型のローカル・バージョンを上げており、それを更に上げる場合はグローバル・バージョン番号も上げる必要があります。<br />
 グローバル・バージョン番号が決まればクラスやenum型のローカル・バージョン番号も決まるようにする必要があるためです。</div><p><b>サンプルをver1cに用意してます。</b>(source/reference_and_test/ver1c/common.h)</p>
 <div class="fragment"><div class="line"><a class="code" href="serializer_8h.html#aed67475e426a84a276f60ae416b6fea1">THEOLIZER_DEFINE_GLOBAL_VERSION_TABLE</a>(MyGVNT, 1);</div></div><!-- fragment --></p>
<p><br />
 </p>
<h2><a class="anchor" id="HowToMakeGlobalVersionNoTable22"></a>
2-2.グローバル・バージョン番号テーブル実体定義</h2>
<p>グローバル・バージョン番号テーブル実体は通常のグローバル変数(配列)として定義されますので、どれか1つのコンパイル単位でのみ実体定義します。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define THEOLIZER_GLOBAL_VERSION_TABLE</span></div></div><!-- fragment --><p>そのコンパイル単位のソース・ファイル(.cpp)の先頭付近で下記を定義することで、Theolizerドライバがこのマクロ定義を認識し、実体をその.cppファイル用の*.theolizer.hpp内に自動生成します。</p>
<p>また、そのコンパイル単位をTheolizerドライバが解析する時に、シリアライズする全てのクラスとenum型の定義とそのシリアライズ指定が必要になります。そこで、当該コンパイル単位ではシリアライズする全ての型を定義したヘッダ・ファイルをインクルードして下さい。</p>
<p><b>サンプルをver1cに用意してます。</b>(source/reference_and_test/ver1c/main.cpp)</p>
 <div class="fragment"><div class="line"><span class="comment">// theolizerライブラリ(グローバル・バージョン番号テーブル生成のためにも必要)</span></div><div class="line"><span class="preprocessor">#include &lt;theolizer/serializer_binary.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;theolizer/serializer_fast.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="serializer__json_8h.html">theolizer/serializer_json.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// プロジェクト・ヘッダ</span></div><div class="line"><span class="preprocessor">#include &quot;common.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// グローバル・バージョン番号テーブル生成</span></div><div class="line"><span class="preprocessor">#define THEOLIZER_GLOBAL_VERSION_TABLE</span></div><div class="line"><span class="preprocessor">#include &quot;test_modify_enum.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;test_modify_class.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;test_modify_complex.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// 自動生成ソース</span></div><div class="line"><span class="preprocessor">#include &quot;main.cpp.theolizer.hpp&quot;</span></div></div><!-- fragment --></p>
<p><br />
 </p><h6></h6>
<h1><a class="anchor" id="HowToModifyEnum3"></a>
3.バージョン番号を変えてenum型を修正</h1>
<h6></h6>
<p>バージョン番号を更新して、enum型をバージョン・アップすることで次の変更ができます。</p>
<ul>
<li>過去割り当てていたシンボルを別の意味で再割当て<br />
 バージョン番号を変えない場合、古いプログラムで保存したシンボルを他のシンボルへ割り当てるため、古いシンボルも割り当てが存在するため変更できません。<br />
 バージョン番号を更新することで、新しいバージョンでは古いシンボルは未定義なので、それを新たに割り当てしても混乱を生じません。<br />
 <br />
</li>
<li>シンボル名保存とシンボル値保存の切り替え<br />
 ローカル・バージョン番号を１つ上げて、シリアライズ指定マクロ名を変えるだけです。</li>
</ul>
<h2><a class="anchor" id="HowToModifyEnum31"></a>
3-1.バージョン・アップ手順</h2>
<p>enum型をバージョン・アップする時の手順は次の通りです。</p>
<ol type="1">
<li>まだ作っていないなら、グローバル・バージョン番号テーブルを作成しておきます。<br />
 <br />
</li>
<li>対象enum型が非侵入型<b>完全自動</b>ならば非侵入型<b>半自動</b>へ変更します。<br />
 完全自動のバージョン・アップに対応していません。<br />
 <br />
</li>
<li>ビルドし、Theolizerドライバにて自動生成ソースへ反映します。<br />
 <br />
</li>
<li>必要な場合はグローバル・バージョン番号をインクリメントします。<br />
 <a class="el" href="_changing_enum.html#HowToMakeGlobalVersionNoTable21">2-1.グローバル・バージョン番号テーブルの宣言</a> 参照。<br />
 <br />
</li>
<li>対象enum型のローカル・バージョン番号をインクリメントします。<br />
 <a class="el" href="_enum_variation.html#HalfAutoEnum">2.非侵入型半自動enum型</a> 参照。<br />
 この時、バージョン・アップ前のバージョンで付けていたTHEOLIZER_ANNOTATE()を一旦全て削除します。<br />
 前バージョンで付けていたものは全て前バージョンへ指定ですので、次のバージョンでは指定内容が完全に異なります。<br />
 <br />
</li>
<li>対象enum型の定義を変更し、前バージョンとの対応付けを行います。<br />
 具体的には後述します。<br />
 <br />
</li>
<li>ビルドします。<br />
</li>
</ol>
<p><br />
 </p>
<h2><a class="anchor" id="HowToModifyEnum32"></a>
3-2.非侵入型半自動への変更方法</h2>
<p>単純にTHEOLIZER_ENUM()マクロで指定しするだけです。対象のenum型定義よりも後、*.theolizer.hppをインクルードする前にTHEOLIZER_ENUM()マクロを置いて下さい。なお、THEOLIZER_ENUM_VALUE()でシンボル値保存へ直接変更することはできません。シンボル値保存へ変更する場合は、ローカル・バージョン番号を更新する時に行って下さい。<br />
</p>
<p><b>サンプル</b><br />
 test_modify_enum.hで定義しているEnumFullAutoとScopedEnumFullAutoはver1a, ver1bまでは非侵入型完全自動ですが、ver1cにて非侵入型半自動へ修正しています。<br />
</p>
<p><b>半自動型へ変更した(ver1c)のソース</b>(source/reference_and_test/ver1c/test_modify_enum.h)</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> EnumFullAuto</div><div class="line">{</div><div class="line">    <span class="comment">// 中略</span></div><div class="line">};</div><div class="line"><a class="code" href="serializer_8h.html#a6b69c6bb89a295c8c3e5a289bd9d4f20">THEOLIZER_ENUM</a>(EnumFullAuto, 1);            <span class="comment">// バージョン・アップに備え半自動型へ変更</span></div><div class="line"></div><div class="line"><span class="keyword">enum class</span> ScopedEnumFullAuto : long</div><div class="line">{</div><div class="line">    <span class="comment">// 中略</span></div><div class="line">};</div><div class="line"><a class="code" href="serializer_8h.html#a6b69c6bb89a295c8c3e5a289bd9d4f20">THEOLIZER_ENUM</a>(ScopedEnumFullAuto, 1);      <span class="comment">// バージョン・アップに備え半自動型へ変更</span></div></div><!-- fragment --><p><br />
 </p>
<h2><a class="anchor" id="HowToModifyEnum33"></a>
3-3.バージョン・アップ時のシンボル対応</h2>
<p>enum型はバージョン・アップする時、前バージョンと現バージョン間のシンボル値の対応を指定することができます。現バージョンのシンボルに対して、対応する前バージョンのシンボル値を指定します。<br />
</p>
<p>この場合、THEOLIZER_ANNOTATE(ES:)の第３パラメータで指定します。</p>
<div class="fragment"><div class="line">enumシンボル <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:::対応する前バージョンのシンボル値)=値,</div><div class="line">    :</div></div><!-- fragment --><p>「対応する前バージョンのシンボル値」はenumシンボルではなく直接数値で指定して下さい。前バージョンのenum型そのものは存在しません。しかし、旧版のenum型シンホルの値を変更することも有りえませんので指定可能です。<br />
 また、前バージョンとシンボル値が変化していない場合は「対応する前バージョンのシンボル値」の指定を省略できます。 <br />
 </p>
<h3><a class="anchor" id="HowToModifyEnum331"></a>
3-3-1.内部処理概要</h3>
<ul>
<li>バージョン・アップ処理<br />
 前バージョンのシンボル値に対して、次のバージョンの各シンボルを先頭から順に枚挙し、「対応する前バージョンのシンボル値」が一致するものを探します。最初に一致したシンボルへ変換します。<br />
 複数のシンボルが一致する時は、先に定義されたシンポルへ変換されます。<br />
 なお、一致するものが見つからなかった時は、デフォルト値を設定し、警告を報告します。<br />
 <br />
</li>
<li>バージョン・ダウン処理<br />
 前バージョンの各シンボルを先頭から順に枚挙し、現バージョンのシンボルの「対応する前バージョンのシンボル値」と一致するものを探します。最初に一致したシンボルへ変換します。<br />
 複数のシンボルが一致する時は、先に定義されたシンポルへ変換されます。<br />
 なお、一致するものが見つからなかった時は、デフォルト値を設定し、警告を報告します。<br />
 <br />
 </li>
</ul>
<h3><a class="anchor" id="HowToModifyEnum332"></a>
3-3-2.以前使用したシンボルの再割当て</h3>
<p>これは、シンボルを名前変更したり削除(デフォルト値へ割り当て)したりした後、変更前に使っていたシンボルを他の意味で使いたいケースを想定しています。<br />
 この場合、バージョン・アップすることで、そのシンボルを他のシンボルへの再割当てすることができます。その際、<a class="el" href="_changing_enum.html#HowToModifyEnum33">3-3.バージョン・アップ時のシンボル対応</a> の方法で指定します。<br />
</p>
<p>再割当てしたいシンボルを「enumシンボル」に追加します。<br />
 この時、「対応する前バージョンのシンボル値」には前バージョンにおける「デフォルト値」を指定して下さい。<br />
 <br />
</p>
<p>なお、上記の指定方法で、バージョン・アップ前のバージョンの特定のシンボルを、以前使っていたシンボルへ戻すことも可能です。ただし、これはシンボルの意味の変更を伴いませんので、バージョン・アップしても問題ないですが、バージョン・アップする必要はありません。</p>
<p>下記の修正を行うサンプルです。</p>
<ul>
<li>旧バージョンの各種指定を削除する</li>
<li>以前使っていたeesnName11を新しいバージョンのenum型へ新規追加する</li>
</ul>
<p><b>バージョン・アップ前(ver1c)のソース</b>(source/reference_and_test/ver1c/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><span class="keyword">enum</span> EnumSymName</div><div class="line">{</div><div class="line">    eesnDefault,</div><div class="line">    eesnValue1=10,</div><div class="line">    eesnName10  <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:eesnName11),</div><div class="line">    eesnName20  <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:eesnName21,eesnName22),</div><div class="line">    eesnName41,</div><div class="line">    eesnName42,</div><div class="line">    eesnName30  <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:eesnName31,eesnName32,eesnName33),</div><div class="line">    eesnName51,</div><div class="line">    eesnName52,</div><div class="line">    eesnDeleted <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:eesnDelete)</div><div class="line">};</div></div><!-- fragment --></p>
<p><b>バージョン・アップ後(ver2a)のソース</b>(source/reference_and_test/ver2a/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><span class="keyword">enum</span> EnumSymName</div><div class="line">{</div><div class="line">    <span class="comment">// 変更無し</span></div><div class="line">    eesnDefault,</div><div class="line">    eesnValue1=10,</div><div class="line">    eesnName10,</div><div class="line">    eesnName20,</div><div class="line">    eesnName41,</div><div class="line">    eesnName42,</div><div class="line">    eesnName30,</div><div class="line">    eesnName51,</div><div class="line">    eesnName52,</div><div class="line">    eesnDeleted,</div><div class="line"></div><div class="line">    <span class="comment">// 追加(前バージョンのeesnDefaultに対応させる)</span></div><div class="line">    eesnName11  <a class="code" href="serializer_8h.html#a821fd2ce199c257be53dcd891f93cf2b">THEOLIZER_ANNOTATE</a>(ES:::0)</div><div class="line">};</div></div><!-- fragment --></p>
<p><br />
 </p>
<h3><a class="anchor" id="HowToModifyEnum34"></a>
3-4.シンボル名保存とシンボル値保存の切り替え</h3>
<p>開発当初は変更対応しやすいシンボル名保存が使い勝手が良いです。（<code>C#</code>での経験ですが、シンボル値を気にしないで良いのはたいへんありがたかったです。)<br />
 ある程度枯れてきたら、シンボル名では効率が悪いのでシンボル値へ変更したくなります。<br />
 そして、再度、大改造する際に一旦シンボル名へ戻したい時もあるでしょう。<br />
 このようなシナリオに対応することを想定しています。</p>
<p>変更は<a class="el" href="_changing_enum.html#HowToModifyEnum31">3-1.バージョン・アップ手順</a> の手順に従います。この6.の手順にて下記マクロ名を切り替えます。<br />
</p>
<ul>
<li>THEOLIZER_ENUM</li>
<li>THEOLIZER_ENUM_VALUE</li>
</ul>
<p>下記の修正を行うサンプルです。</p>
<ul>
<li>旧バージョンのシンボル名保存enum型をシンボル値保存enum型へ変更(EnumSymName)</li>
</ul>
<p><b>バージョン・アップ前(ver2a)のソース</b>(source/reference_and_test/ver2a/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><a class="code" href="serializer_8h.html#a6b69c6bb89a295c8c3e5a289bd9d4f20">THEOLIZER_ENUM</a>(EnumSymName, 2);</div></div><!-- fragment --></p>
<p><b>バージョン・アップ後(ver3a)のソース</b>(source/reference_and_test/ver3a/test_modify_enum.h)</p>
 <div class="fragment"><div class="line"><a class="code" href="serializer_8h.html#af2bd28fd8daca6b3d9ea66246f19bfc1">THEOLIZER_ENUM_VALUE</a>(EnumSymName, 3);</div></div><!-- fragment --> <br />
 </p><h6></h6>
<h1><a class="anchor" id="HowToModifyEnum4"></a>
4.網羅的な使用例（自動テスト）の説明</h1>
<h6></h6>
<p>enum型の修正に関する網羅的なテストは <a class="el" href="_usage_total.html#TestProgram">4.テスト・プログラムの構造</a> で説明した各フォルダの下記2つのファイルにて実装しています。</p>
<ul>
<li>test_modify_enum.h</li>
<li>test_modify_enum.cpp</li>
</ul>
<p>unscoped enum型とscoped enum型について下記の修正を行い、<a class="el" href="_usage_total.html#TestProgram412">4-1-2.テストの組み合わせ</a> の各バージョン間で正しく回復できることを確認しています。</p>
<table class="doxtable">
<tr>
<th>バージョン</th><th>修正点</th><th>特記事項  </th></tr>
<tr>
<td>ver1a→ver1b</td><td>1.シンボル値変更<br />
2.シンボル名変更(a→b)<br />
3.シンボル名変更(a,b,c→a)<br />
4.シンボル名変更(a,b,c→d)<br />
5.シンボル名削除(指定ミス)</td><td><br />
単純変更<br />
3つから先頭の1つへ対応<br />
3つから別の1つへ対応<br />
指定ミスは対応先指定漏れ警告が出ることを確認 </td></tr>
<tr>
<td>ver1b→ver1c</td><td>1.グローバル・バージョン番号テーブル作成<br />
2.完全自動型を半自動型へ変更<br />
3.シンボル名削除指定ミスの修正</td><td>警告が消えることを確認 </td></tr>
<tr>
<td>ver1c→ver2a</td><td>1.バージョン・アップ<br />
2.以前使っていたシンボルの再割当て</td><td></td></tr>
<tr>
<td>ver2a→ver3a</td><td>1.バージョン名保存→バージョン値保存<br />
2.バージョン値保存→バージョン名保存<br />
3.前バージョンとの対応指定ミス</td><td>バージョン・アップ処理と回復処理で警告が出ることを確認<br />
(元完全自動型はバージョン・アップ無し) </td></tr>
<tr>
<td>ver3a→ver3b</td><td>指定ミスの修正</td><td>警告が消えることを確認<br />
(元完全自動型はバージョン・アップ無し) </td></tr>
</table>
<p>ver3a/test_modify_enum.cppのtutoriseModifyEnum()関数にて対応シンボルが無い時のバージョン・ダウン処理、および、保存処理に於ける警告検出をjson形式を用いてテストしています。</p>
<p>ver3b/test_modify_enum.cppのtutoriseModifyEnum()関数にて上記警告が消えることをテストしています。 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.12-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
	<ul>
    <li class="navelem"><a class="el" href="index.html">--目次--</a></li><li class="navelem"><a class="el" href="_usage_individual.html">使用方法（個別）</a></li>
		<span style="color:#364D7C";>
			&nbsp;&nbsp;&copy; 2016 <a href="http://theolizer.com/">Theoride Technology</a> All Rights Reserved.
      &nbsp;&nbsp;"Theolizer" is a registered trademark of Theoride Technology.
		</span>
    <li class="footer">
			構築:
    	<a href="http://www.doxygen.org/index.html">
    		<img class="footer" src="doxygen.png" alt="doxygen"/>
			</a>
			1.8.12
		</li>
  </ul>
</div>
</body>
</html>
